首先在页面上增加分页导航栏，新建 views/components/pager.ejs，添加如下代码

**views/components/pager.ejs**
```html
<div class="ui grid">
    <div class="four wide column"></div>
    <div class="eight wide column">
        <% if (pager.pageIndex > 1) { %>
            <a href="/posts?<%= pager.queryStringOfAuthor %>pageIndex=<%= pager.pageIndex - 1 %>">上一页</a>
            <a href="/posts?<%= pager.queryStringOfAuthor %>pageIndex=1">1</a>
        <% } %>   
        <% if (pager.pageIndex > 5) { %>
            ...
        <% } %>
        <% for (var i = Math.max(2, pager.pageIndex-3); i < pager.pageIndex; i++) { %>
            <a href="/posts?<%= pager.queryStringOfAuthor %>pageIndex=<%= i %>"><%= i %></a>
        <% } %> 
        <%= pager.pageIndex %>
        <% for (var i = pager.pageIndex+1 ; i < Math.min(pager.pagesCount, pager.pageIndex+4); i++) { %>
            <a href="/posts?<%= pager.queryStringOfAuthor %>pageIndex=<%= i %>"><%= i %></a>
        <% } %> 
        <% if (pager.pageIndex < pager.pagesCount-4) { %>
            ...
        <% } %>
        <% if (pager.pageIndex < pager.pagesCount) { %>   
            <a href="/posts?<%= pager.queryStringOfAuthor %>pageIndex=<%= pager.pagesCount %>"><%= pager.pagesCount %></a>     
            <a href="/posts?<%= pager.queryStringOfAuthor %>pageIndex=<%= pager.pageIndex + 1 %>">下一页</a>
        <% } %>           
    </div>
</div>
```
> 效果：上一页 1 ... 4 5 6 7 8 9 10 ... 21 下一页
> 通过当前页 pageIndex 和总页数 pagesCount 进行判断，确定具体显示内容,其中 queryStringOfAuthor 是作者的查询字符串

然后修改 views/posts.ejs，增加分页导航栏显示，添加如下代码：

**views/posts.ejs**
```
<%- include('components/pager', { pager: pager }) %>
```
> 为方便测试效果，可以把导航栏放在文章列表上方

为了取得总页数，需要得到文章总数，在 models/posts.js 中增加 getPostsCount 函数

**models/posts.js**
```js
  // 获取所有用户或某个用户的所有文章数量
  getPostsCount: function getPostsCount (author) {
    const query = {}
    if (author) {
      query.author = author
    }
    return Post
      .count(query)
      .exec()
  },
```

同时之前用来获取文章的函数也需要增加页码相关参数：pageIndex, pageSize，并修改如下

**models/posts.js**
```js
  // 按创建时间降序获取所有用户或者某个特定用户的指定页文章
  getPosts: function getPosts (author, pageIndex, pageSize) {
    const query = {}
    if (author) {
      query.author = author
    }
    return Post
      .find(query)
      .populate({ path: 'author', model: 'User' }) // 读取author对应的User对象
      .sort({ _id: -1 })
      .skip((pageIndex - 1) * pageSize)
      .limit(pageSize)
      .addCreatedAt()
      .addCommentsCount()
      .contentToHtml()
      .exec()
  },
```
>用 skup() 和 limit() 方法来截取指定页的内容

最后修改 routes/posts.js 中的 GET /posts 路由，使其支持页码跳转，修改代码如下：

**routes/posts.js**
```js
router.get('/', function (req, res, next) {
  const author = req.query.author
  const pageIndex = (req.query.pageIndex - 0) || 1 // 转化为数字
  const pageSize = 10 // req.query.pageSize

  PostModel.getPosts(author, pageIndex, pageSize)
    .then(function (posts) {
      PostModel.getPostsCount(author)
        .then(function (postsCount) {
          res.render('posts', {
            posts: posts,            
            pager: {              
              pageIndex: pageIndex,
              pagesCount: Math.ceil(postsCount / pageSize),
              queryStringOfAuthor: (author) ? 'author='+author+'&': ''
            }
          })
        })
    })
    .catch(next)
})
```
> pageSize 默认设置为10，queryStringOfAuthor 为作者查询字符串，无作者时为空。
